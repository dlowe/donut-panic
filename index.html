<html>
        <head>
        </head>
        <body>
        </body>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
        <script language="javascript">
                game = (function () {
                        var ws;
                        var States = {
                                UNOPENED: 0,
                                READY: 1,
                                STARTED: 2
                        };
                        var state = States.UNOPENED;

                        return {
                                start: function(host, port, cookie) {
                                        ws = new WebSocket("ws://" + host + ":" + port + "/play-game/" + cookie);
                                        ws.onopen = function() {
                                                ws.send("ready");
                                                state = States.READY;
                                        }
                                        ws.onmessage = function(event) {
                                                if (event.data.lastIndexOf('start:', 0) === 0) {
                                                        if (state === States.READY) {
                                                                ws.send("started");
                                                                state = States.STARTED;
                                                        } else {
                                                                throw "wtf?"
                                                        }
                                                }
                                        }
                                }
                        };
                })();
                $(function() {
                        $.ajax({
                                'url': '/api/new-game',
                                'type': 'POST',
                                'success': function(new_data) {
                                        $.ajax({
                                                'url': '/api/join-game/' + new_data.game_id,
                                                'type': 'POST',
                                                'success': function(join_data) {
                                                        game.start(join_data.host,
                                                                   join_data.port,
                                                                   join_data.cookie);
                                                }
                                        });
                                }
                        });
                });
        </script>

</body>
</html>
